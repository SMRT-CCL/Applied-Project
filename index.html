<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <section class="background-image"></section>

    <nav>
        <select id="devices">
            <option value="default-device" style="color: #de8636;">Select A Device</option>
            <option value="device-1" style="color: #de8636;">HC-05</option>
        </select>
    </nav>

    <section id="default-page">
        <div id="button">
            <div id="lock-button" >
                <i class="material-icons" style="font-size: 150px;">&#xe899;</i>
            </div>
    
            <div id="unlock-button" style="display: none;">
                <i class="material-icons" style="font-size: 150px;">&#xe898;</i>
            </div>
        </div>
    
        <div id="lock-message">LOCKED</div>
        <div id="unlock-message" style="display: none;">UNLOCKED</div>
    </section>
    
    <section id="device-1-page" style="display: none;">
        <div id="hc-button">
            <div id="hc-lock-button" >
                <i class="material-icons" style="font-size: 150px;">&#xe899;</i>
            </div>
    
            <div id="hc-unlock-button" style="display: none;">
                <i class="material-icons" style="font-size: 150px;">&#xe898;</i>
            </div>
        </div>
    
        <div id="hc-lock-message">LOCKED</div>
        <div id="hc-unlock-message" style="display: none;">UNLOCKED</div>
    </section>

    <footer>
        <div id="user-icon">
            <i class="material-icons" style="font-size: 40px; color: white; cursor: not-allowed;">&#xe7fb;</i>
        </div>

        <div id="lock-icon">
            <i class="material-icons" style="font-size: 40px; color: white; cursor: not-allowed;">&#xe897;</i>
        </div>

        <div id="setting-icon">
            <i class="material-icons" style="font-size: 40px; color: white; cursor: not-allowed;">&#xe8b8;</i>
        </div>
    </footer>
    <script type="text/javascript" src="app.js"></script>
    <script>
        let bluetoothDevice;
    let bluetoothCharacteristic;

    // Function to connect to Bluetooth device
    async function connectBluetooth() {
      try {
        console.log("Requesting Bluetooth device...");
        bluetoothDevice = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'HC-05' }],
          optionalServices: ['battery_service'] // Replace with the service you're using
        });

        console.log("Connecting to Bluetooth device...");
        const server = await bluetoothDevice.gatt.connect(); // Try to connect to GATT server
        console.log("Connected to Bluetooth device!");

        // Log device and server to confirm successful connection
        console.log(bluetoothDevice);  // Log the device details
        console.log(server);           // Log the server details

        // You can add event listener for disconnections
        bluetoothDevice.addEventListener('gattserverdisconnected', () => {
          console.log('Bluetooth device disconnected!');
        });

        // Here, you would proceed to interact with the device (send/receive data)
      } catch (error) {
            console.log("Error connecting to Bluetooth device: ", error);
        }
    }

    // Function to send command to Bluetooth device
    async function sendCommand(command) {
      if (!bluetoothDevice) {
        alert("No Bluetooth device connected");
        return;
      }

      try {
        const encoder = new TextEncoder();
        const data = encoder.encode(command);
        await bluetoothCharacteristic.writeValue(data);  // Send the command
        console.log(`Sent command: ${command}`);
      } catch (error) {
        console.log("Error sending command: ", error);
      }
    }

    // Connect to Bluetooth when the page loads
    window.onload = connectBluetooth;
    </script>
</body>
</html>